/*!
 * Neo-Chart.js
 * https://github.com/WolfgangKurz/Neo-Chart
 * Version: 1.0.13
 *
 * Copyright 2016-2018 Wolfgang Kurz
 * Released under the MIT license
 * https://github.com/WolfgangKurz/Neo-Chart/blob/master/LICENSE
 */
"use strict";!function(){var t=function(t){return document.querySelector(t)};t.find=function(t,e){return t.querySelector(e)},HTMLElement.prototype.find=function(t){return this.querySelector(t)},HTMLElement.prototype.attr=function(t,e){return void 0===e?this.getAttribute(t):(this.setAttribute(t,e),this)},window.neoChart=function(e){var a=e.getContext("2d"),l=t("."+e.attr("data-target")),r={index:-1,baseX:0,cellWidth:0},s={title:e.attr("data-title")?e.attr("data-title"):"",background:e.attr("data-background")?e.attr("data-background"):"#FFFFFF",gridVertColor:e.attr("data-vert-grid-color")?e.attr("data-vert-grid-color"):"#e8e8e8",gridHorzColor:e.attr("data-horz-grid-color")?e.attr("data-horz-grid-color"):"#b6b6b6",baselineColor:e.attr("data-baseline-color")?e.attr("data-baseline-color"):"#b6b6b6",labels:l.find(".chart-data-label").value.split(","),style:e.attr("data-style")?e.attr("data-style").split(","):["line"],"x-prefix":e.attr("data-x-prefix")?e.attr("data-x-prefix"):"","x-postfix":e.attr("data-x-postfix")?e.attr("data-x-postfix"):"","y-prefix":e.attr("data-y-prefix")?e.attr("data-y-prefix"):"","y-postfix":e.attr("data-y-postfix")?e.attr("data-y-postfix"):"","bar-y-prefix":e.attr("data-bar-y-prefix")?e.attr("data-bar-y-prefix"):"","bar-y-postfix":e.attr("data-bar-y-postfix")?e.attr("data-bar-y-postfix"):"",min:e.attr("data-min")?parseInt(e.attr("data-min")):0,max:e.attr("data-min")?parseInt(e.attr("data-max")):100,bars:e.attr("data-bars")?parseInt(e.attr("data-bars")):1,splits:e.attr("data-split")?parseInt(e.attr("data-split")):parseInt(e.height/36),type:e.attr("data-type")};s["bar-min"]=e.attr("data-bar-min")?parseInt(e.attr("data-bar-min")):s.min,s["bar-max"]=e.attr("data-bar-max")?parseInt(e.attr("data-bar-max")):s.max;for(var i=0;i<s.style.length;i++){for(var n=[],o=[],f=[],d=0;;d++){var h=l.find(".chart-data-"+s.style[i]+"-dataset"+d);if(null==h)break;var b=[];h=h.value.split(",");for(var x=0;x<h.length;x++)if(h[x].toString().indexOf(";")>=0){for(var p=h[x].toString().split(";"),c=0;c<p.length;c++)p[c]=parseFloat(p[c]);b.push(p)}else b.push(parseFloat(h[x]));n.push(b);var y=l.find(".chart-data-"+s.style[i]+"-color"+d).value.split(",");f.push(y);var g=l.find(".chart-data-"+s.style[i]+"-dataname"+d).value.split(",");o.push(g)}s[s.style[i]+"-dataset"]=n,s[s.style[i]+"-names"]=o,s[s.style[i]+"-colors"]=f}var m=["bar","line"],u=[];for(d=0;d<m.length;d++){for(x=0;x<s.style.length;x++)if(!(u.indexOf(s.style[x])>=0)&&m[d]==s.style[x]){u.push(s.style[x]);break}for(x=0;x<s.style.length;x++)u.indexOf(s.style[x])>=0||u.push(s.style[x])}s.style=u;var v=function(){var t,l,i,n,o,f,d=e.width,h=e.height,b=s.max-s.min,x=s["bar-max"]-s["bar-min"],p=0,c=0,y=function(t){return s["x-prefix"]+t+s["x-postfix"]},g=function(t){return s["y-prefix"]+(isNaN(t)?"-":t)+s["y-postfix"]},m=function(t){return s["bar-y-prefix"]+(isNaN(t)?"-":t)+s["bar-y-postfix"]};a.setTransform(1,0,0,1,0,0),a.lineWidth=.9,a.fillStyle=s.background,a.clearRect(0,0,d,h),a.fillRect(0,0,d,h),a.translate(.5,.5),a.font="12px Arial",o=a.measureText(g(s.max)),i=t=parseInt(o.width),n=d-parseInt(t),i+=parseInt(n/s.labels.length/2),n-=t,o=a.measureText(y(s.labels[0])),l=18;for(var u=0;u<s.style.length;u++){if("bar"==s.style[u])c=(v=parseInt(n/s.labels.length/2))/s.bars,o=a.measureText(m(s["bar-max"])),i-=4,d-=(p=parseInt(o.width))+8,n-=p+14}r.baseX=8+t+4+8,r.cellWidth=n/s.labels.length,r.bottom=h-8-l-8,r.top=8,s.title.length>0&&(a.translate(0,20),r.top+=20,h-=20,a.fillStyle="#7c7c7c",a.font="bold 16px Arial",o=a.measureText(s.title),a.fillText(s.title,d/2-o.width/2,0)),a.font="12px Arial",a.fillStyle="#8c8c8c",a.strokeStyle=s.gridHorzColor;for(u=0;u<s.labels.length;u++){if(r.index==u){a.fillStyle="rgba(212,212,212,0.17)";var v=parseInt((n*u-n/2)/s.labels.length);a.fillRect(8+i+4+8+v,8,n/s.labels.length,h-8-l-8-8),a.fillStyle="#8c8c8c"}v=y(s.labels[u]);f=(o=a.measureText(v)).width,a.fillText(v,8+i+4+8+n*u/s.labels.length-f/2,h-l+4),v=parseInt((n*u+n/2)/s.labels.length),a.strokeStyle=s.gridVertColor,a.beginPath(),a.moveTo(8+i+4+8+v,12),a.lineTo(8+i+4+8+v,h-8-l-8),a.closePath(),a.stroke(),a.strokeStyle=s.gridHorzColor,a.beginPath(),a.moveTo(8+i+4+8+v,h-8-l-8),a.lineTo(8+i+4+8+v,h-8-l),a.closePath(),a.stroke()}a.beginPath();for(u=0;u<s.splits+1;u++){var T=g(s.max-parseInt((s.max-s.min)*u/s.splits));if(f=(o=a.measureText(T)).width,a.fillText(T,8+t-f,8+(h-8-l)*u/(s.splits+1)+18),u<s.splits&&(T=parseInt((h-8-l)*u/(s.splits+1)),a.moveTo(8+t+4,8+T+14),a.lineTo(d-12,8+T+14)),p>0){T=m(s["bar-max"]-parseInt((s["bar-max"]-s["bar-min"])*u/s.splits));a.fillText(T,d-8,8+(h-8-l)*u/(s.splits+1)+18)}}a.closePath(),a.stroke(),a.strokeStyle=s.baselineColor,a.beginPath(),a.moveTo(8+t+4,h-8-l-8),a.lineTo(d-12,h-8-l-8),a.closePath(),a.stroke(),a.beginPath(),a.moveTo(8+t+4+8,12),a.lineTo(8+t+4+8,h-8-l),p>0&&(a.moveTo(d-8-8-4,12),a.lineTo(d-8-8-4,h-8-l)),a.closePath(),a.stroke();var w=0;a.font="bold 12px Arial";for(var I=0;I<s.style.length;I++)switch(s.style[I]){case"line":a.lineWidth=1.3;for(u=0;u<s["line-dataset"].length;u++){var S=s["line-dataset"][u];a.strokeStyle=s["line-colors"][u],a.beginPath();for(var k=0;k<S.length;k++){T=(h-l-38)*S[k]/b;0==k?a.moveTo(8+i+4+8+parseInt(n*k/s.labels.length),h-8-l-8-T):a.lineTo(8+i+4+8+parseInt(n*k/s.labels.length),h-8-l-8-T)}a.stroke()}for(u=0;u<s["line-dataset"].length;u++)for(S=s["line-dataset"][u],k=0;k<S.length;k++){v=8+i+4+8+parseInt(n*k/s.labels.length),T=(h-l-38)*S[k]/b;a.lineWidth=1.78,a.strokeStyle=s["line-colors"][u],a.beginPath(),a.arc(v,h-8-l-8-T,3,0,2*Math.PI,!0),a.closePath(),a.stroke(),a.lineWidth=1.3,a.strokeStyle="#FFFFFF",a.beginPath(),a.arc(v,h-8-l-8-T,4.3,0,2*Math.PI,!0),a.closePath(),a.stroke(),a.fillStyle=s["line-colors"][u],a.save(),o=a.measureText(g(S[k])),a.shadowColor="rgba(0, 0, 0, 0.17)",a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=7,w=Math.max(o.width,w);var F=h-8-l-8-T+12+8;F+10>h-8-l-8&&(F-=28),a.fillText(g(S[k]),v-parseInt(o.width/2),F),a.restore()}break;case"bar":a.lineWidth=.9;for(u=0;u<s["bar-dataset"].length;u++){S=s["bar-dataset"][u];a.strokeStyle="#727272";for(k=0;k<S.length;k++){v=8+i+4+8+parseInt(n*k/s.labels.length);if("object"==typeof S[k])for(var P=0;P<Math.min(S[k].length,s.bars);P++){a.fillStyle=s["bar-colors"][u][P];T=(h-l-38)*S[k][P]/x;a.fillRect(v-c/2*s.bars+P*c,h-8-l-8-T,c,T),a.strokeRect(v-c/2*s.bars+P*c,h-8-l-8-T,c,T),o=a.measureText(S[k][P]),w=Math.max(o.width,w)}else{a.fillStyle=s["bar-colors"][k][0];T=(h-l-38)*S[k]/x;a.fillRect(v-c/2*s.bars,h-8-l-8-T,c,T),a.strokeRect(v-c/2*s.bars,h-8-l-8-T,c,T),o=a.measureText(S[k]),w=Math.max(o.width,w)}}}}w=parseInt(w);var M=0,C=32,R=18,W=0;for(I=0;I<s.style.length;I++){S=s[s.style[I]+"-dataset"];S=s[s.style[I]+"-names"];for(var O=0;O<S.length;O++)if("object"==typeof S[O]){for(u=0;u<S[O].length;u++)o=a.measureText(S[O][u]),W=Math.max(parseInt(o.width),W);C+=16*S[O].length}else o=a.measureText(S[O]),W=Math.max(parseInt(o.width),W),C+=16*S.length;switch(s.style[I]){case"line":for(u=0;u<s["line-dataset"].length;u++)for(S=s["line-dataset"][u],O=0;O<S.length;O++)if("object"==typeof S[O])for(P=0;P<S[O].length;P++)o=a.measureText(g(S[O][P])),M=Math.max(parseInt(o.width),M);else o=a.measureText(g(S[O])),M=Math.max(parseInt(o.width),M);break;case"bar":for(u=0;u<s["bar-dataset"].length;u++)for(S=s["bar-dataset"][u],O=0;O<S.length;O++)if("object"==typeof S[O])for(P=0;P<Math.min(S[O].length,s.bars);P++)o=a.measureText(g(S[O][P])),M=Math.max(parseInt(o.width),M);else o=a.measureText(g(S[O])),M=Math.max(parseInt(o.width),M)}}M+=(W+=8)+18;for(O=0;O<s.labels.length;O++)if(r.index==O){a.fillStyle="#FFFFFF",a.strokeStyle="#959595";v=parseInt((n*O+n/1.5)/s.labels.length);(v+=8+i+4+8)+M>=d-20&&(v-=parseInt(n/s.labels.length)+M+32),a.save(),a.shadowColor="rgba(0, 0, 0, 0.43)",a.shadowOffsetX=0,a.shadowOffsetY=2,a.shadowBlur=4,a.strokeRect(v,72,M,C),a.restore(),a.fillRect(v,72,M,C),a.fillStyle="#383838",o=a.measureText(s.labels[O]),a.fillText(s.labels[O],v+parseInt(M/2-o.width/2),72+R),R+=20;for(I=0;I<s.style.length;I++)switch(s.style[I]){case"line":for(u=0;u<s["line-dataset"].length;u++){S=s["line-dataset"][u];a.fillStyle="#383838",a.fillText(s["line-names"][u],v+8,72+R),a.fillStyle=s["line-colors"][u],a.fillText(g(S[O]),W+v+8,72+R),R+=16}break;case"bar":a.lineWidth=.9;for(u=0;u<s["bar-dataset"].length;u++){S=s["bar-dataset"][u];if(a.strokeStyle="#727272","object"==typeof S[O])for(P=0;P<Math.min(S[O].length,s.bars);P++)a.fillStyle="#383838",a.fillText(s["bar-names"][u][P],v+8,72+R),a.fillStyle=s["bar-colors"][u][P],a.fillText(m(S[O][P]),W+v+8,72+R),R+=16;else a.fillStyle="#383838",a.fillText(s["bar-names"][O],v+8,72+R),a.fillStyle=s["bar-colors"][O][0],a.fillText(m(S[O]),W+v+8,72+R),R+=16}}}},T=function(){var t=window.getComputedStyle(e.parentNode,null);e.width=parseInt(t.getPropertyValue("width")),v()};e.addEventListener("mousemove",function(t){var e=r.index;t.offsetY<r.top?r.index=-1:t.offsetY>=r.bottom?r.index=-1:(r.index=Math.floor((t.offsetX-r.baseX)/r.cellWidth),r.index<0?r.index=-1:r.index>=s.labels.length&&(r.index=-1)),e!=r.index&&v()}),e.addEventListener("mouseleave",function(t){r.index=-1,v()}),window.addEventListener("resize",T),T()}}()
