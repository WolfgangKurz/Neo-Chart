/*!
 * Neo-Chart.js
 * https://github.com/WolfgangKurz/Neo-Chart
 * Version: 1.0.8
 *
 * Copyright 2016 Wolfgang Kurz
 * Released under the MIT license
 * https://github.com/WolfgangKurz/Neo-Chart/blob/master/LICENSE
 */
"use strict";!function(){var a=function(a){return document.querySelector(a)};a.find=function(a,b){return a.querySelector(b)},HTMLElement.prototype.find=function(a){return this.querySelector(a)},HTMLElement.prototype.attr=function(a,b){return"undefined"==typeof b?this.getAttribute(a):(this.setAttribute(a,b),this)},window.neoChart=function(b){var c=b.getContext("2d"),d=a("."+b.attr("data-target")),e={index:-1,baseX:0,cellWidth:0},f={title:b.attr("data-title")?b.attr("data-title"):"",background:b.attr("data-background")?b.attr("data-background"):"#FFFFFF",labels:d.find(".chart-data-label").value.split(","),style:b.attr("data-style")?b.attr("data-style").split(","):["line"],"x-prefix":b.attr("data-x-prefix")?b.attr("data-x-prefix"):"","x-postfix":b.attr("data-x-postfix")?b.attr("data-x-postfix"):"","y-prefix":b.attr("data-y-prefix")?b.attr("data-y-prefix"):"","y-postfix":b.attr("data-y-postfix")?b.attr("data-y-postfix"):"","bar-y-prefix":b.attr("data-bar-y-prefix")?b.attr("data-bar-y-prefix"):"","bar-y-postfix":b.attr("data-bar-y-postfix")?b.attr("data-bar-y-postfix"):"",min:b.attr("data-min")?parseInt(b.attr("data-min")):0,max:b.attr("data-min")?parseInt(b.attr("data-max")):100,bars:b.attr("data-bars")?parseInt(b.attr("data-bars")):1,splits:b.attr("data-split")?parseInt(b.attr("data-split")):parseInt(b.height/36),type:b.attr("data-type")};f["bar-min"]=b.attr("data-bar-min")?parseInt(b.attr("data-bar-min")):f.min,f["bar-max"]=b.attr("data-bar-max")?parseInt(b.attr("data-bar-max")):f.max;for(var g=0;g<f.style.length;g++){for(var h=[],i=[],j=[],k=0;;k++){var l=d.find(".chart-data-"+f.style[g]+"-dataset"+k);if(null==l)break;var m=[];l=l.value.split(",");for(var n=0;n<l.length;n++)if(l[n].toString().indexOf(";")>=0){for(var o=l[n].toString().split(";"),p=0;p<o.length;p++)o[p]=parseFloat(o[p]);m.push(o)}else m.push(parseFloat(l[n]));h.push(m);var q=d.find(".chart-data-"+f.style[g]+"-color"+k).value.split(",");j.push(q);var r=d.find(".chart-data-"+f.style[g]+"-dataname"+k).value.split(",");i.push(r)}f[f.style[g]+"-dataset"]=h,f[f.style[g]+"-names"]=i,f[f.style[g]+"-colors"]=j}for(var s=["bar","line"],t=[],k=0;k<s.length;k++){for(var n=0;n<f.style.length;n++)if(!(t.indexOf(f.style[n])>=0)&&s[k]==f.style[n]){t.push(f.style[n]);break}for(var n=0;n<f.style.length;n++)t.indexOf(f.style[n])>=0||t.push(f.style[n])}f.style=t;var u=function(){var l,m,o,p,a=b.width,d=b.height,g=f.max-f.min,h=f["bar-max"]-f["bar-min"],i=0,j=0,k=0,n=0,r=function(a){return f["x-prefix"]+a+f["x-postfix"]},s=function(a){return f["y-prefix"]+(isNaN(a)?"-":a)+f["y-postfix"]},t=function(a){return f["bar-y-prefix"]+(isNaN(a)?"-":a)+f["bar-y-postfix"]};c.setTransform(1,0,0,1,0,0),c.lineWidth=.9,c.fillStyle=f.background,c.clearRect(0,0,a,d),c.fillRect(0,0,a,d),c.translate(.5,.5),c.font="12px Arial",o=c.measureText(s(f.max)),i=parseInt(o.width),l=i,m=a-parseInt(i),l+=parseInt(m/f.labels.length/2),m-=i,o=c.measureText(r(f.labels[0])),k=18;for(var u=0;u<f.style.length;u++)if("bar"==f.style[u]){var v=parseInt(m/f.labels.length/2);n=v/f.bars,o=c.measureText(t(f["bar-max"])),j=parseInt(o.width),l-=4,a-=j+8,m-=j+14}e.baseX=8+i+4+8,e.cellWidth=m/f.labels.length,e.bottom=d-8-k-8,e.top=8,f.title.length>0&&(c.translate(0,20),e.top+=20,d-=20,c.fillStyle="#7c7c7c",c.font="bold 16px Arial",o=c.measureText(f.title),c.fillText(f.title,a/2-o.width/2,0)),c.font="12px Arial",c.fillStyle="#8c8c8c",c.strokeStyle="#e8e8e8";for(var u=0;u<f.labels.length;u++){if(e.index==u){c.fillStyle="rgba(212,212,212,0.17)";var v=parseInt((m*u-m/2)/f.labels.length);c.fillRect(8+l+4+8+v,8,m/f.labels.length,d-8-k-8-8),c.fillStyle="#8c8c8c"}var v=r(f.labels[u]);o=c.measureText(v),p=o.width,c.fillText(v,8+l+4+8+m*u/f.labels.length-p/2,d-k+4),v=parseInt((m*u+m/2)/f.labels.length),c.strokeStyle="#e8e8e8",c.beginPath(),c.moveTo(8+l+4+8+v,12),c.lineTo(8+l+4+8+v,d-8-k-8),c.closePath(),c.stroke(),c.strokeStyle="#b6b6b6",c.beginPath(),c.moveTo(8+l+4+8+v,d-8-k-8),c.lineTo(8+l+4+8+v,d-8-k),c.closePath(),c.stroke()}c.beginPath();for(var u=0;u<f.splits+1;u++){var w=s(f.max-parseInt((f.max-f.min)*u/f.splits));if(o=c.measureText(w),p=o.width,c.fillText(w,8+i-p,8+(d-8-k)*u/(f.splits+1)+18),u<f.splits&&(w=parseInt((d-8-k)*u/(f.splits+1)),c.moveTo(8+i+4,8+w+14),c.lineTo(a-12,8+w+14)),j>0){var w=t(f["bar-max"]-parseInt((f["bar-max"]-f["bar-min"])*u/f.splits));c.fillText(w,a-8,8+(d-8-k)*u/(f.splits+1)+18)}}c.closePath(),c.stroke(),c.strokeStyle="#b6b6b6",c.beginPath(),c.moveTo(8+i+4,d-8-k-8),c.lineTo(a-12,d-8-k-8),c.closePath(),c.stroke(),c.beginPath(),c.moveTo(8+i+4+8,12),c.lineTo(8+i+4+8,d-8-k),j>0&&(c.moveTo(a-8-8-4,12),c.lineTo(a-8-8-4,d-8-k)),c.closePath(),c.stroke();var x=0;c.font="bold 12px Arial";for(var y=0;y<f.style.length;y++)switch(f.style[y]){case"line":c.lineWidth=1.3;for(var u=0;u<f["line-dataset"].length;u++){var z=f["line-dataset"][u];c.strokeStyle=f["line-colors"][u],c.beginPath();for(var A=0;A<z.length;A++){var w=(d-k-38)*z[A]/g;0==A?c.moveTo(8+l+4+8+parseInt(m*A/f.labels.length),d-8-k-8-w):c.lineTo(8+l+4+8+parseInt(m*A/f.labels.length),d-8-k-8-w)}c.stroke()}for(var u=0;u<f["line-dataset"].length;u++)for(var z=f["line-dataset"][u],A=0;A<z.length;A++){var v=8+l+4+8+parseInt(m*A/f.labels.length),w=(d-k-38)*z[A]/g,B=d-8-k-8-w-8;if(A>0){var C=(d-k-38)*z[A-1]/g;C=d-8-k-8-C-8,Math.abs(B-C)<14&&(B-=10)}if(A<z.length-1){var C=(d-k-38)*z[A+1]/g;C=d-8-k-8-C-8,Math.abs(B-C)<14&&(B-=10)}c.lineWidth=1.78,c.strokeStyle=f["line-colors"][u],c.beginPath(),c.arc(v,d-8-k-8-w,3,0,2*Math.PI,!0),c.closePath(),c.stroke(),c.lineWidth=1.3,c.strokeStyle="#FFFFFF",c.beginPath(),c.arc(v,d-8-k-8-w,4.3,0,2*Math.PI,!0),c.closePath(),c.stroke(),c.fillStyle=f["line-colors"][u],c.save(),o=c.measureText(s(z[A])),c.shadowColor="rgba(0, 0, 0, 0.17)",c.shadowOffsetX=0,c.shadowOffsetY=0,c.shadowBlur=7,x=Math.max(o.width,x),c.fillText(s(z[A]),v-parseInt(o.width/2),B),c.restore()}break;case"bar":c.lineWidth=.9;for(var u=0;u<f["bar-dataset"].length;u++){var z=f["bar-dataset"][u];c.strokeStyle="#727272";for(var A=0;A<z.length;A++){var v=8+l+4+8+parseInt(m*A/f.labels.length);if("object"==typeof z[A])for(var D=0;D<Math.min(z[A].length,f.bars);D++){c.fillStyle=f["bar-colors"][u][D];var w=(d-k-38)*z[A][D]/h;c.fillRect(v-n/2*f.bars+D*n,d-8-k-8-w,n,w),c.strokeRect(v-n/2*f.bars+D*n,d-8-k-8-w,n,w),o=c.measureText(z[A][D]),x=Math.max(o.width,x)}else{c.fillStyle=f["bar-colors"][A][0];var w=(d-k-38)*z[A]/h;c.fillRect(v-n/2*f.bars,d-8-k-8-w,n,w),c.strokeRect(v-n/2*f.bars,d-8-k-8-w,n,w),o=c.measureText(z[A]),x=Math.max(o.width,x)}}}}x=parseInt(x);for(var E=0,F=28,G=18,H=0,y=0;y<f.style.length;y++){var z=f[f.style[y]+"-dataset"];F+=16*z.length,z=f[f.style[y]+"-names"];for(var I=0;I<z.length;I++)if("object"==typeof z[I])for(var u=0;u<z[I].length;u++)o=c.measureText(z[I][u]),H=Math.max(parseInt(o.width),H);else o=c.measureText(z[I]),H=Math.max(parseInt(o.width),H);switch(f.style[y]){case"line":for(var u=0;u<f["line-dataset"].length;u++){var z=f["line-dataset"][u];o=c.measureText(s(z[I])),E=Math.max(parseInt(o.width),E)}break;case"bar":for(var u=0;u<f["bar-dataset"].length;u++){var z=f["bar-dataset"][u];if("object"==typeof z[I])for(var D=0;D<Math.min(z[I].length,f.bars);D++)o=c.measureText(s(z[I][D])),E=Math.max(parseInt(o.width),E);else o=c.measureText(s(z[I])),E=Math.max(parseInt(o.width),E)}}}H+=8,E+=H+32;for(var I=0;I<f.labels.length;I++)if(e.index==I){c.fillStyle="#FFFFFF",c.strokeStyle="#959595";var v=parseInt((m*I+m/1.5)/f.labels.length);v+=8+l+4+8,v+E>=a-20&&(v-=E+8+l+4+8),c.save(),c.shadowColor="rgba(0, 0, 0, 0.43)",c.shadowOffsetX=0,c.shadowOffsetY=2,c.shadowBlur=4,c.strokeRect(v,72,E,F),c.restore(),c.fillRect(v,72,E,F);for(var y=0;y<f.style.length;y++)switch(f.style[y]){case"line":for(var u=0;u<f["line-dataset"].length;u++){var z=f["line-dataset"][u];c.fillStyle="#383838",c.fillText(f["line-names"][u],v+8,72+G),c.fillStyle=f["line-colors"][u],c.fillText(s(z[I]),H+v+8,72+G),G+=16}break;case"bar":c.lineWidth=.9;for(var u=0;u<f["bar-dataset"].length;u++){var z=f["bar-dataset"][u];if(c.strokeStyle="#727272","object"==typeof z[I])for(var D=0;D<Math.min(z[I].length,f.bars);D++)c.fillStyle="#383838",c.fillText(f["bar-names"][u][D],v+8,72+G),c.fillStyle=f["bar-colors"][u][D],c.fillText(t(z[I][D]),H+v+8,72+G),G+=16;else c.fillStyle="#383838",c.fillText(f["bar-names"][I],v+8,72+G),c.fillStyle=f["bar-colors"][I][0],c.fillText(t(z[I]),H+v+8,72+G),G+=16}}}},v=function(){var a=window.getComputedStyle(b.parentNode,null);b.width=parseInt(a.getPropertyValue("width")),u()};b.addEventListener("mousemove",function(a){var b=e.index;a.offsetY<e.top?e.index=-1:a.offsetY>=e.bottom?e.index=-1:(e.index=Math.floor((a.offsetX-e.baseX)/e.cellWidth),e.index<0?e.index=-1:e.index>=f.labels.length&&(e.index=-1)),b!=e.index&&u()}),b.addEventListener("mouseleave",function(a){e.index=-1,u()}),window.addEventListener("resize",v),v()}}()
